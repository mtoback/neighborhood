function initialize(){var mapProp={center:new google.maps.LatLng(51.508742,-.12085),zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP};new google.maps.Map(document.getElementById("googleMap"),mapProp)}var viewModel={address:ko.observable(""),city:ko.observable(""),searches:ko.observableArray(["Post Office","Restaurant","Grocery Stores"]),searchTag:ko.observable(),localWeather:ko.observable(),weather:function(lat,lng){$.ajax({url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+lat+","+lng+"&sensor=true",success:function(result){for(var components=result.results[0].address_components,len=components.length,foundCity=!1,foundState=!1,city="",state="",i=0;len>i&&(!foundCity||!foundState);i++){var component=components[i];"locality"===component.types[0]?(city=component.long_name,foundCity=!0):"administrative_area_level_1"===component.types[0]&&(state=component.short_name,found_state=!0)}$.ajax({url:"http://api.wunderground.com/api/421920ddc8bd7347/forecast/q/"+state+"/"+city+".json",success:function(result){var forecast=result.forecast.simpleforecast.forecastday[0],temp=forecast.low.fahrenheit+"-"+forecast.high.fahrenheit,conditions=forecast.conditions;viewModel.localWeather(conditions+":"+temp)}})}})},generateMap:function(){$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+this.location(),success:function(result){function nonce_generate(){return Math.floor(1e12*Math.random()).toString()}var lat=result.results[0].geometry.location.lat,lng=result.results[0].geometry.location.lng;viewModel.weather(lat,lng);var mapProp={center:new google.maps.LatLng(lat,lng),zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP};$("#googleMap").show();var map=new google.maps.Map(document.getElementById("googleMap"),mapProp),auth={consumerKey:"IuMIJl585jfMDHz7spOj3w",consumerSecret:"8qnDc0yEa59ZHfXN1uM3XY-RcW4",accessToken:"bfEYLApv2Hxfs0vDEh6TMRsOllsGYEG1",accessTokenSecret:"zcavaTCQX2wlPIjvm4DqUzzGV94",serviceProvider:{signatureMethod:"HMAC-SHA1"}},parameters=(viewModel.location(),{consumerSecret:auth.consumerSecret,tokenSecret:auth.accessTokenSecret},{oauth_consumer_key:"IuMIJl585jfMDHz7spOj3w",oauth_token:"bfEYLApv2Hxfs0vDEh6TMRsOllsGYEG1",oauth_nonce:nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:$("#searchTag").val(),location:viewModel.location()}),yelp_url="https://api.yelp.com/v2/search",encodedSignature=oauthSignature.generate("GET",yelp_url,parameters,"8qnDc0yEa59ZHfXN1uM3XY-RcW4","zcavaTCQX2wlPIjvm4DqUzzGV94");parameters.oauth_signature=encodedSignature,$.ajax({url:yelp_url,data:parameters,cache:!0,dataType:"jsonp",success:function(results){var businesses=results.businesses;businesses.forEach(function(business){function toggleBounce(){null!==marker.getAnimation()?marker.setAnimation(null):marker.setAnimation(google.maps.Animation.BOUNCE)}var name=business.name,lat=(business.mobile_url,business.location.coordinate.latitude),lng=business.location.coordinate.longitude,myLatlng=new google.maps.LatLng(lat,lng),marker=new google.maps.Marker({position:myLatlng,animation:google.maps.Animation.DROP,title:name});marker.addListener("click",toggleBounce),marker.setMap(map)})},error:function(xhr,ajaxOptions,thrownError){alert(xhr.status),alert(thrownError)}})}})}};viewModel.location=ko.computed(function(){return this.address()+","+this.city()},viewModel),ko.applyBindings(viewModel),$("#googleMap").hide(),google.maps.event.addDomListener(window,"load",initialize);