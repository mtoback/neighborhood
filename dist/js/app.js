function setMapOnAll(map,markers){for(var i=0;i<markers.length;i++)markers[i].setMap(map)}function initialize(){var mapProp={center:new google.maps.LatLng(51.508742,-.12085),zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP};new google.maps.Map(document.getElementById("googleMap"),mapProp)}var viewModel={address:ko.observable(""),city:ko.observable(""),searches:ko.observableArray(["Post Office","Restaurant","Grocery Stores"]),markers:ko.observableArray(),displayMarkers:ko.observableArray(),searchTag:ko.observable(),localWeather:ko.observable(),filter:ko.observable(""),zoom:ko.observable(12),filterMap:function(){var filter=viewModel.filter();if(viewModel.markers().length>0){setMapOnAll(null,viewModel.displayMarkers()),viewModel.displayMarkers.removeAll();for(var i=0;i<viewModel.markers().length;i++)viewModel.markers()[i].title.indexOf(filter)>-1&&viewModel.displayMarkers.push(viewModel.markers()[i]);setMapOnAll(map,viewModel.displayMarkers())}},weather:function(lat,lng){$.ajax({url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+lat+","+lng+"&sensor=true",success:function(result){for(var components=result.results[0].address_components,len=components.length,foundCity=!1,foundState=!1,city="",state="",i=0;len>i&&(!foundCity||!foundState);i++){var component=components[i];"locality"===component.types[0]?(city=component.long_name,foundCity=!0):"administrative_area_level_1"===component.types[0]&&(state=component.short_name,found_state=!0)}$.ajax({url:"http://api.wunderground.com/api/421920ddc8bd7347/forecast/q/"+state+"/"+city+".json",success:function(result){var forecast=result.forecast.simpleforecast.forecastday[0],temp=forecast.low.fahrenheit+"-"+forecast.high.fahrenheit,conditions=forecast.conditions;viewModel.localWeather(conditions+":"+temp)}})}})},generateMap:function(){$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+this.location(),success:function(result){function nonce_generate(){return Math.floor(1e12*Math.random()).toString()}var lat=result.results[0].geometry.location.lat,lng=result.results[0].geometry.location.lng;viewModel.weather(lat,lng);var mapProp={center:new google.maps.LatLng(lat,lng),zoom:viewModel.zoom(),mapTypeId:google.maps.MapTypeId.ROADMAP};$("#googleMap").show(),map=new google.maps.Map(document.getElementById("googleMap"),mapProp);var auth={consumerKey:"IuMIJl585jfMDHz7spOj3w",consumerSecret:"8qnDc0yEa59ZHfXN1uM3XY-RcW4",accessToken:"bfEYLApv2Hxfs0vDEh6TMRsOllsGYEG1",accessTokenSecret:"zcavaTCQX2wlPIjvm4DqUzzGV94",serviceProvider:{signatureMethod:"HMAC-SHA1"}},parameters=(viewModel.location(),{consumerSecret:auth.consumerSecret,tokenSecret:auth.accessTokenSecret},{oauth_consumer_key:"IuMIJl585jfMDHz7spOj3w",oauth_token:"bfEYLApv2Hxfs0vDEh6TMRsOllsGYEG1",oauth_nonce:nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:"restaurant",location:viewModel.location(),radius_filter:viewModel.radius_filter()}),yelp_url="https://api.yelp.com/v2/search",encodedSignature=oauthSignature.generate("GET",yelp_url,parameters,"8qnDc0yEa59ZHfXN1uM3XY-RcW4","zcavaTCQX2wlPIjvm4DqUzzGV94");parameters.oauth_signature=encodedSignature,$.ajax({url:yelp_url,data:parameters,cache:!0,dataType:"jsonp",success:function(results){var businesses=results.businesses;businesses.forEach(function(business){function toggleBounce(){null!==marker.getAnimation()?marker.setAnimation(null):marker.setAnimation(google.maps.Animation.BOUNCE)}var name=business.name,url=business.mobile_url,lat=business.location.coordinate.latitude,lng=business.location.coordinate.longitude,myLatlng=new google.maps.LatLng(lat,lng),marker=new google.maps.Marker({position:myLatlng,animation:google.maps.Animation.DROP,title:name,url:url});viewModel.markers.push(marker),viewModel.displayMarkers.push(marker),marker.addListener("click",toggleBounce),marker.setMap(map)}),businesses.length>0&&$("#search").show()},error:function(xhr,ajaxOptions,thrownError){alert(xhr.status),alert(thrownError)}})}})}};viewModel.radius_filter=ko.computed(function(){return 11===this.zoom()?4e4:12===this.zoom()?2e4:(13===this.zoom(),1e4)},viewModel),viewModel.location=ko.computed(function(){return this.address()+","+this.city()},viewModel),ko.applyBindings(viewModel),$("#slider").slider({value:250,min:0,max:500,step:250,slide:function(event,ui){var value=ui.value;viewModel.zoom(11+value/250)}}),$("#googleMap").hide(),google.maps.event.addDomListener(window,"load",initialize);